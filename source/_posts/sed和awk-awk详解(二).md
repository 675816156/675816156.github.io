---
title: awk详解
date: YYYY-MM-DD HH:mm:ss
categories: 
- shell脚本
tags:
- awk编程模型
- 调用awk三种方式：
- awk模式匹配
- 记录和域
- 关系和布尔运算符
- awk布尔运算符
- awk算数运算符
- awk环境变量及其意义
- 格式化输出
	- printf修饰符及其意义
	- printf格式符及其意义
- 内置字符串函数
- 向awk脚本传递参数
- awk条件语句和循环语句
- 数组
	- 关联数组
		- 访问关联数组：
---
# awk编程模型

|   第一阶段：读取输入文件之前，由BEGIN标识    |
| :------------------------------------------: |
| 第二阶段：主输入循环，对每个输入文件进行处理 |
|    第三阶段：读取输入文件完毕，由END标识     |

# 调用awk三种方式：

- 在shell命令行输入：

```
awk [-F 域分隔符] 'awk 程序段' 输入文件
```

- 将awk程序段插入脚本文件，然后通过awk命令调用它：

```
awk -f awk脚本文件 输入文件
```

- 将awk命令插入脚本文件后直接执行：

```
./awk脚本文件 输入文件
```

# awk模式匹配

任何awk语句都由模式(pattern)和动作(action)组成。模式决定动作何时触发和触发事件，动作执行对输入行的处理。awk可支持”?”和”+”两个扩展元字符，而grep和sed不支持。

# 记录和域

awk将每个输入行定义为记录，行中每个字符串定义为域，域之间用空格、Tab键或其他符号进行分隔，此符号叫分隔符。
$0 表示所有的域，$1第一个域……

改变域分隔符，除了使用-F参数，还可以设置环境变量FS的值来达到目的。

# 关系和布尔运算符

| 运算符 |       意义       |
| :----: | :--------------: |
|   <    |       小于       |
|   >    |       大于       |
|   <=   |     小于等于     |
|   >=   |     大于等于     |
|   ==   |       等于       |
|   !=   |      不等于      |
|   ~    |  匹配正则表达式  |
|   !~   | 不匹配正则表达式 |

# awk布尔运算符

| 运算符 |  意义  |
| :----: | :----: |
| 双竖线 | 逻辑或 |
|   &&   | 逻辑与 |
|   !    | 逻辑非 |

# awk算数运算符

| 运算符 |          意义           |
| :----: | :---------------------: |
|   +    |           加            |
|   -    |           减            |
|   *    |           乘            |
|   /    |           除            |
|   %    |           模            |
| ^或**  |          乘方           |
|  ++x   | 在返回x值之前，x变量加1 |
|  x++   | 在返回x值之后，x变量加1 |

# awk环境变量及其意义

|   变量名    |                  意义                  |
| :---------: | :------------------------------------: |
|     $n      |    当前记录的第n个域，域间由FS分割     |
|     $0      |              记录的所有域              |
|    ARGC     |            命令行参数的数量            |
|   ARGIND    |  命令行中当前文件的位置(以0开始标号)   |
|    ARGV     |            命令行参数的数组            |
|   CONVFMT   |              数字转换格式              |
|   ENVIRON   |            环境变量关联数组            |
|    ERRNO    |         最后一个系统错误的描述         |
| FIELDWIDTHS |       字段宽度列表，以空格键分隔       |
|  FILENAME   |               当前文件名               |
|     FNR     |            浏览文件的记录数            |
|     FS      |         字段分隔符，默认是空格         |
| IGNORECASE  | 布尔变量，如果是真，则忽略大小写的匹配 |
|     NF      |           当前记录中的域数量           |
|     NR      |               当前记录数               |
|    OFMT     |             数字的输出格式             |
|     OFS     |        输出域分隔符，默认是空格        |
|     ORS     |        输出记录分隔符，默认换行        |
|   RLENGTH   |     由match函数所匹配的字符串长度      |
|     RS      |          记录分隔符，默认空格          |
|   RSTART    |  由match函数所匹配的字符串的第1个位置  |
|   SUBSEP    |      数组下标分隔符，默认值是\034      |

# 格式化输出

```
printf(格式控制符, 参数)
```

## printf修饰符及其意义

| 修饰符 |       意义       |
| :----: | :--------------: |
|   -    |      左对齐      |
| width  |     域的步长     |
| .prec  | 小数点右边的位数 |

## printf格式符及其意义

| 格式符 |        意义        |
| :----: | :----------------: |
|   %c   |     ASCII字符      |
|   %d   |       整型数       |
|   %e   | 浮点数，科学计数法 |
|   %f   |       浮点数       |
|   %o   |      八进制数      |
|   %s   |       字符串       |
|   %x   |     十六进制数     |

# 内置字符串函数

|     函数名      |                 意义                  |
| :-------------: | :-----------------------------------: |
|   gsub(r, s)    |         在输入文件中用s替换r          |
|  gsub(r, s, t)  |             在t中用s替换r             |
|   index(s, t)   |         返回s中第一个t的位置          |
|    length(s)    |              返回s的长度              |
|   match(s, t)   |      测试s是否包含匹配t的字符串       |
| split(r, s, t)  |           在t上将r分成序列s           |
|  sub(r, s, t)   |       将t中第一次出现的r替换为s       |
|  substr(r, s)   |    返回字符串r中从s开始的后缀部分     |
| substr(r, s, t) | 返回字符串r总从s开始长度为t的后缀部分 |

# 向awk脚本传递参数

```
awk 脚本 parameter=value 输入文件
```

***注意：***命令行参数不能被BEGIN字段语句访问。

# awk条件语句和循环语句

和C语言的语法完全一样。

```
if (条件表达式)
	动作1
[else
	动作2]

while (条件表达式)
	动作

do
	动作
while (条件表达式)

for (设置计数器初值;测试计数器;计数器变化)
	动作
```



# 数组

```
array[index]=value
```

## 关联数组

关联数组是指数组的索引可以是字符串，也可以是数字。awk中所有数组都是关联数组。

### 访问关联数组：

```
for (variable in array)
   	do something with array[variable]
```

判断键值是否关联到数组

```
if (index in array)
   	......
```
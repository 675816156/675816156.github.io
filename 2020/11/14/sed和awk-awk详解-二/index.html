<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="google-site-verification" content="TZE0rZyIqLl10trYu3BWBWa1Vmz6HFwhb2OcNEK4u-s" />
     <link rel="shortcut icon" href= /img/favicon.ico >
    <title>
        陈俊的个人博客
    </title>
    <meta name="description" content= The faintest ink is better than the best memory. >
    <meta name="keywords" content= Blog,Hexo,Chenjun >
    
<link rel="stylesheet" href="/libs/highlight/styles/monokai-sublime.css">

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.2.0"></head>
<body id="bodyx">
    <div class="hd posts">
    <a href="/index.html"><i class="fa fa-home
 replay-btn" aria-hidden="true"></i></a>
    <div class="post-title">
        <p>
            awk详解
        </p>
        <hr>
    </div>
    <div class="post-content">
        <h1 id="awk编程模型"><a href="#awk编程模型" class="headerlink" title="awk编程模型"></a>awk编程模型</h1><table>
<thead>
<tr>
<th align="center">第一阶段：读取输入文件之前，由BEGIN标识</th>
</tr>
</thead>
<tbody><tr>
<td align="center">第二阶段：主输入循环，对每个输入文件进行处理</td>
</tr>
<tr>
<td align="center">第三阶段：读取输入文件完毕，由END标识</td>
</tr>
</tbody></table>
<h1 id="调用awk三种方式："><a href="#调用awk三种方式：" class="headerlink" title="调用awk三种方式："></a>调用awk三种方式：</h1><ul>
<li>在shell命令行输入：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk [-F 域分隔符] &#39;awk 程序段&#39; 输入文件</span><br></pre></td></tr></table></figure>

<ul>
<li>将awk程序段插入脚本文件，然后通过awk命令调用它：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -f awk脚本文件 输入文件</span><br></pre></td></tr></table></figure>

<ul>
<li>将awk命令插入脚本文件后直接执行：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;awk脚本文件 输入文件</span><br></pre></td></tr></table></figure>

<h1 id="awk模式匹配"><a href="#awk模式匹配" class="headerlink" title="awk模式匹配"></a>awk模式匹配</h1><p>任何awk语句都由模式(pattern)和动作(action)组成。模式决定动作何时触发和触发事件，动作执行对输入行的处理。awk可支持”?”和”+”两个扩展元字符，而grep和sed不支持。</p>
<h1 id="记录和域"><a href="#记录和域" class="headerlink" title="记录和域"></a>记录和域</h1><p>awk将每个输入行定义为记录，行中每个字符串定义为域，域之间用空格、Tab键或其他符号进行分隔，此符号叫分隔符。<br>$0 表示所有的域，$1第一个域……</p>
<p>改变域分隔符，除了使用-F参数，还可以设置环境变量FS的值来达到目的。</p>
<h1 id="关系和布尔运算符"><a href="#关系和布尔运算符" class="headerlink" title="关系和布尔运算符"></a>关系和布尔运算符</h1><table>
<thead>
<tr>
<th align="center">运算符</th>
<th align="center">意义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">&lt;</td>
<td align="center">小于</td>
</tr>
<tr>
<td align="center">&gt;</td>
<td align="center">大于</td>
</tr>
<tr>
<td align="center">&lt;=</td>
<td align="center">小于等于</td>
</tr>
<tr>
<td align="center">&gt;=</td>
<td align="center">大于等于</td>
</tr>
<tr>
<td align="center">==</td>
<td align="center">等于</td>
</tr>
<tr>
<td align="center">!=</td>
<td align="center">不等于</td>
</tr>
<tr>
<td align="center">~</td>
<td align="center">匹配正则表达式</td>
</tr>
<tr>
<td align="center">!~</td>
<td align="center">不匹配正则表达式</td>
</tr>
</tbody></table>
<h1 id="awk布尔运算符"><a href="#awk布尔运算符" class="headerlink" title="awk布尔运算符"></a>awk布尔运算符</h1><table>
<thead>
<tr>
<th align="center">运算符</th>
<th align="center">意义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">双竖线</td>
<td align="center">逻辑或</td>
</tr>
<tr>
<td align="center">&amp;&amp;</td>
<td align="center">逻辑与</td>
</tr>
<tr>
<td align="center">!</td>
<td align="center">逻辑非</td>
</tr>
</tbody></table>
<h1 id="awk算数运算符"><a href="#awk算数运算符" class="headerlink" title="awk算数运算符"></a>awk算数运算符</h1><table>
<thead>
<tr>
<th align="center">运算符</th>
<th align="center">意义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">+</td>
<td align="center">加</td>
</tr>
<tr>
<td align="center">-</td>
<td align="center">减</td>
</tr>
<tr>
<td align="center">*</td>
<td align="center">乘</td>
</tr>
<tr>
<td align="center">/</td>
<td align="center">除</td>
</tr>
<tr>
<td align="center">%</td>
<td align="center">模</td>
</tr>
<tr>
<td align="center">^或**</td>
<td align="center">乘方</td>
</tr>
<tr>
<td align="center">++x</td>
<td align="center">在返回x值之前，x变量加1</td>
</tr>
<tr>
<td align="center">x++</td>
<td align="center">在返回x值之后，x变量加1</td>
</tr>
</tbody></table>
<h1 id="awk环境变量及其意义"><a href="#awk环境变量及其意义" class="headerlink" title="awk环境变量及其意义"></a>awk环境变量及其意义</h1><table>
<thead>
<tr>
<th align="center">变量名</th>
<th align="center">意义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">$n</td>
<td align="center">当前记录的第n个域，域间由FS分割</td>
</tr>
<tr>
<td align="center">$0</td>
<td align="center">记录的所有域</td>
</tr>
<tr>
<td align="center">ARGC</td>
<td align="center">命令行参数的数量</td>
</tr>
<tr>
<td align="center">ARGIND</td>
<td align="center">命令行中当前文件的位置(以0开始标号)</td>
</tr>
<tr>
<td align="center">ARGV</td>
<td align="center">命令行参数的数组</td>
</tr>
<tr>
<td align="center">CONVFMT</td>
<td align="center">数字转换格式</td>
</tr>
<tr>
<td align="center">ENVIRON</td>
<td align="center">环境变量关联数组</td>
</tr>
<tr>
<td align="center">ERRNO</td>
<td align="center">最后一个系统错误的描述</td>
</tr>
<tr>
<td align="center">FIELDWIDTHS</td>
<td align="center">字段宽度列表，以空格键分隔</td>
</tr>
<tr>
<td align="center">FILENAME</td>
<td align="center">当前文件名</td>
</tr>
<tr>
<td align="center">FNR</td>
<td align="center">浏览文件的记录数</td>
</tr>
<tr>
<td align="center">FS</td>
<td align="center">字段分隔符，默认是空格</td>
</tr>
<tr>
<td align="center">IGNORECASE</td>
<td align="center">布尔变量，如果是真，则忽略大小写的匹配</td>
</tr>
<tr>
<td align="center">NF</td>
<td align="center">当前记录中的域数量</td>
</tr>
<tr>
<td align="center">NR</td>
<td align="center">当前记录数</td>
</tr>
<tr>
<td align="center">OFMT</td>
<td align="center">数字的输出格式</td>
</tr>
<tr>
<td align="center">OFS</td>
<td align="center">输出域分隔符，默认是空格</td>
</tr>
<tr>
<td align="center">ORS</td>
<td align="center">输出记录分隔符，默认换行</td>
</tr>
<tr>
<td align="center">RLENGTH</td>
<td align="center">由match函数所匹配的字符串长度</td>
</tr>
<tr>
<td align="center">RS</td>
<td align="center">记录分隔符，默认空格</td>
</tr>
<tr>
<td align="center">RSTART</td>
<td align="center">由match函数所匹配的字符串的第1个位置</td>
</tr>
<tr>
<td align="center">SUBSEP</td>
<td align="center">数组下标分隔符，默认值是\034</td>
</tr>
</tbody></table>
<h1 id="格式化输出"><a href="#格式化输出" class="headerlink" title="格式化输出"></a>格式化输出</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">printf(格式控制符, 参数)</span><br></pre></td></tr></table></figure>

<h2 id="printf修饰符及其意义"><a href="#printf修饰符及其意义" class="headerlink" title="printf修饰符及其意义"></a>printf修饰符及其意义</h2><table>
<thead>
<tr>
<th align="center">修饰符</th>
<th align="center">意义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-</td>
<td align="center">左对齐</td>
</tr>
<tr>
<td align="center">width</td>
<td align="center">域的步长</td>
</tr>
<tr>
<td align="center">.prec</td>
<td align="center">小数点右边的位数</td>
</tr>
</tbody></table>
<h2 id="printf格式符及其意义"><a href="#printf格式符及其意义" class="headerlink" title="printf格式符及其意义"></a>printf格式符及其意义</h2><table>
<thead>
<tr>
<th align="center">格式符</th>
<th align="center">意义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">%c</td>
<td align="center">ASCII字符</td>
</tr>
<tr>
<td align="center">%d</td>
<td align="center">整型数</td>
</tr>
<tr>
<td align="center">%e</td>
<td align="center">浮点数，科学计数法</td>
</tr>
<tr>
<td align="center">%f</td>
<td align="center">浮点数</td>
</tr>
<tr>
<td align="center">%o</td>
<td align="center">八进制数</td>
</tr>
<tr>
<td align="center">%s</td>
<td align="center">字符串</td>
</tr>
<tr>
<td align="center">%x</td>
<td align="center">十六进制数</td>
</tr>
</tbody></table>
<h1 id="内置字符串函数"><a href="#内置字符串函数" class="headerlink" title="内置字符串函数"></a>内置字符串函数</h1><table>
<thead>
<tr>
<th align="center">函数名</th>
<th align="center">意义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">gsub(r, s)</td>
<td align="center">在输入文件中用s替换r</td>
</tr>
<tr>
<td align="center">gsub(r, s, t)</td>
<td align="center">在t中用s替换r</td>
</tr>
<tr>
<td align="center">index(s, t)</td>
<td align="center">返回s中第一个t的位置</td>
</tr>
<tr>
<td align="center">length(s)</td>
<td align="center">返回s的长度</td>
</tr>
<tr>
<td align="center">match(s, t)</td>
<td align="center">测试s是否包含匹配t的字符串</td>
</tr>
<tr>
<td align="center">split(r, s, t)</td>
<td align="center">在t上将r分成序列s</td>
</tr>
<tr>
<td align="center">sub(r, s, t)</td>
<td align="center">将t中第一次出现的r替换为s</td>
</tr>
<tr>
<td align="center">substr(r, s)</td>
<td align="center">返回字符串r中从s开始的后缀部分</td>
</tr>
<tr>
<td align="center">substr(r, s, t)</td>
<td align="center">返回字符串r总从s开始长度为t的后缀部分</td>
</tr>
</tbody></table>
<h1 id="向awk脚本传递参数"><a href="#向awk脚本传递参数" class="headerlink" title="向awk脚本传递参数"></a>向awk脚本传递参数</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk 脚本 parameter&#x3D;value 输入文件</span><br></pre></td></tr></table></figure>

<p><strong><em>注意：</em></strong>命令行参数不能被BEGIN字段语句访问。</p>
<h1 id="awk条件语句和循环语句"><a href="#awk条件语句和循环语句" class="headerlink" title="awk条件语句和循环语句"></a>awk条件语句和循环语句</h1><p>和C语言的语法完全一样。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">if (条件表达式)</span><br><span class="line">	动作1</span><br><span class="line">[else</span><br><span class="line">	动作2]</span><br><span class="line"></span><br><span class="line">while (条件表达式)</span><br><span class="line">	动作</span><br><span class="line"></span><br><span class="line">do</span><br><span class="line">	动作</span><br><span class="line">while (条件表达式)</span><br><span class="line"></span><br><span class="line">for (设置计数器初值;测试计数器;计数器变化)</span><br><span class="line">	动作</span><br></pre></td></tr></table></figure>



<h1 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array[index]&#x3D;value</span><br></pre></td></tr></table></figure>

<h2 id="关联数组"><a href="#关联数组" class="headerlink" title="关联数组"></a>关联数组</h2><p>关联数组是指数组的索引可以是字符串，也可以是数字。awk中所有数组都是关联数组。</p>
<h3 id="访问关联数组："><a href="#访问关联数组：" class="headerlink" title="访问关联数组："></a>访问关联数组：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for (variable in array)</span><br><span class="line">   	do something with array[variable]</span><br></pre></td></tr></table></figure>

<p>判断键值是否关联到数组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if (index in array)</span><br><span class="line">   	......</span><br></pre></td></tr></table></figure>
    </div>

    
</div>
    <div class="footer" id="footer">
    <p><h4>Copyright © 2020 | Author: Chen Jun | Theme By <a class="theme-author" target="_blank" rel="noopener" href="https://github.com/Xunzhuo/hexo-theme-coder" style="font-size:14px; color: #969696">Coder</a></h4>
    
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <span id="busuanzi_container_site_pv">Page Views: <span id="busuanzi_value_site_pv"></span></span>
        <span class="post-meta-divider">|</span>
        <span id="busuanzi_container_site_uv">Unique Visitors: <span id="busuanzi_value_site_uv"></span></span>
    
    <label class="el-switch el-switch-blue el-switch-sm" style="vertical-align: sub;">
        <input type="checkbox" name="switch" id="update_style">
        <span class="el-switch-style"></span>
    </label>

    <!--         <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");
    document.write(unescape("%3Cspan id='cnzz_stat_icon_1278548644'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/stat.php%3Fid%3D1278548644%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
    </script> -->
</p>
</div>

<input type="hidden" id="web_style" value="light">
<input type="hidden" id="valine_appid" value="NOsswOncKgc8HOxqo9oxIWlX-gzGzoHsz">
<input type="hidden" id="valine_appKey" value="z1FihjWEbS8uIfUQdmCtK7zz">

<script src="/libs/jquery.min.js"></script>


<script src="/libs/highlight/highlight.pack.js"></script>

<script src='//cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js'></script>

<script src="/js/js.js"></script>

<style type="text/css">
.v * {
color: #698fca;
}
.v .vlist .vcard .vhead .vsys {
color: #3a3e4a;
}
.v .vlist .vcard .vh .vmeta .vat {
color: #638fd5;
}
.v .vlist .vcard .vhead .vnick {
color: #6ba1ff;
}
.v a {
color: #8696b1;
}
.v .vlist .vcard .vhead .vnick:hover {
color: #669bfc;
}
</style>
    <script type="text/javascript" color="173,174,173" opacity='1' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
</body>
</html>
